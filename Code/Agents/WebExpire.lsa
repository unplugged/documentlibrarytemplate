<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE agent SYSTEM 'xmlschemas/domino_8_5_3.dtd'>
<agent name='(WebExpire)' xmlns='http://www.lotus.com/dxl' version='8.5' maintenanceversion='3.0'
 replicaid='80257AC2002D6A1A' hide='v3' runaswebuser='true' publicaccess='false'
 designerversion='6.5' language='en' comment='This performs the expiring/unexpiring of document functions for the web user.'
 restrictions='unrestricted'>
<noteinfo noteid='15e' unid='DFF9A3D034295BE8852564B400622101' sequence='34'>
<created><datetime dst='true'>19970612T135149,77-04</datetime></created>
<modified><datetime>20121206T082302,31+00</datetime></modified>
<revised><datetime>20121206T082302,30+00</datetime></revised>
<lastaccessed><datetime>20121206T082302,31+00</datetime></lastaccessed>
<addedtofile><datetime>20121126T081603,11+00</datetime></addedtofile></noteinfo>
<updatedby><name>CN=Matt White/O=Exhilarate</name></updatedby>
<wassignedby><name>CN=Matt White/O=Exhilarate</name></wassignedby>
<designchange><datetime>20121206T082300,44+00</datetime></designchange>
<trigger type='agentlist'/>
<documentset type='runonce'/><code event='options'><lotusscript>Option Public
Use "wStringResource"
Use "DiscussionRoutines"


</lotusscript></code><code event='declarations'><lotusscript>Dim topicview As String
Dim favorites As String
Dim categoryview As String
Dim archivingview As String
Dim authorview As String
Dim originalnote As notesdocument

</lotusscript></code><code event='initialize'><lotusscript>Sub Initialize
	Set session = New NotesSession
	Set note = session.DocumentContext
	Set db = session.currentdatabase
	dbpath = getdbpath
	
'this part is different from discsw46.ntf and is because doclib has different view aliases
'------------------------------------------------------------------------------          
'Get real document
	OriginalUNID = Mid(note.Query_String(0), Instr(note.Query_String(0), "&amp;")+1, 32)
	Set originalNote = db.getdocumentbyunid(originalunid)
	
	CurrentDocument = "&lt;hr&gt;&lt;font size=2&gt;&lt;a href=/"+dbpath+"/($All)/"+Lcase(originalUNID)+"?OpenDocument&gt;" + getstring(1)  + "&lt;/a&gt;&amp;nbsp&amp;nbsp&amp;nbsp"
	TopicView =   "&lt;a href=/" + dbpath + "/($All)?OpenView&gt;" + getstring(2)  + "&lt;/a&gt;&amp;nbsp&amp;nbsp&amp;nbsp"
	CategoryView = "&lt;a href=/" + dbpath + "/ByCategory?OpenView&gt;" + getstring(3)  + "&lt;/a&gt;&amp;nbsp&amp;nbsp&amp;nbsp"
	AuthorView = "&lt;a href=/" + dbpath + "/ByAuthor?OpenView&gt;" + getstring(4)  + "&lt;/a&gt;&amp;nbsp&amp;nbsp&amp;nbsp"
	AltnameView = "&lt;a href=/" + dbpath + "/by+Alternate+Name?OpenView&gt;" + getstring(5)  + "&lt;/a&gt;&amp;nbsp&amp;nbsp&amp;nbsp "
	ReviewView = "&lt;a href=/" + dbpath + "/ReviewStatus?OpenView&gt;" + getString(33) + "&lt;/a&gt;&lt;hr&gt;"
	Links = Currentdocument+topicview+authorview+categoryview+ Altnameview + reviewview
'------------------------------------------------------------------------------     
	
'The following is the same as that in discsw46.ntf (except for the Links variable)
	If Originalnote.hasitem("protectfromarchive") Then
		Print "&lt;b&gt;"+Originalnote.form(0)+GetString(12)+"&lt;/b&gt;"+Links
	Elseif OriginalNote.hasitem("expiredate") Then
		If originalnote.expiredate(0) &lt;&gt; "" Then
			Print "&lt;h3&gt;" + GetString(13)+ "&lt;/h3&gt;"+Links
			OriginalNote.Removeitem("Expiredate")
			Call OriginalNote.save(True, False)
		Else
			OriginalNote.expiredate = Today
			Call OriginalNote.save(True,False)
			Print "&lt;h3&gt;"+ GetString(14) + "&lt;/h3&gt;"+Links
		End If
	Else
		OriginalNote.expiredate = Today
		Call OriginalNote.save(True,False)
		Print "&lt;h3&gt;" + GetString(14) +  "&lt;/h3&gt;"+Links
	End If
	
End Sub</lotusscript></code></agent>

